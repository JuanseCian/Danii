const timelineData = [
    {
        fecha: "30 DE SEPTIEMBRE DE 2022",
        titulo: "Mis primeras usurpadas",
        texto: "",
        imagen: [
            "img/2022/usurpada.jpeg",
            "img/2022/usurpada2.jpeg"
        ]
    },
    {
        fecha: "2 DE OCTUBRE",
        titulo: "Nuestra primer salida, con final felizðŸ’•",
        texto: "",
        imagen: [
            "img/2022/salida.jpeg",
            "img/2022/salida2.jpeg"
        ]
    },
    {
        fecha: "7 DE DICIEMBRE DE 2022",
        titulo: "El casamiento de la Mabeeeel",
        texto: "",
        imagen: [
            "img/2022/casamiento_mabel1.jpeg",
            "img/2022/casamiento_mabel2.jpeg",
            "img/2022/casamiento_mabel3.jpeg"
        ]
    },
    {
        fecha: "25 DE DICIEMBRE DE 2022",
        titulo: "Nuestra primera Navidad ðŸŽ„",
        texto: "Pasar Navidad juntos fue mÃ¡gico. Luces, abrazos y la calidez de estar con vos.",
        imagen: "img/2022/navidad.png"
    },
    {
        fecha: "31 DE DICIEMBRE DE 2022",
        titulo: "Primer aÃ±ito nuevo juntos",
        texto: "",
        imagen: [
            "img/2022/anio_nuevo1.jpeg",
            "img/2022/anio_nuevo2.jpeg",
            "img/2022/anio_nuevo3.jpeg"
        ]
    },
    {
        fecha: "15 DE ENERO DE 2023",
        titulo: "Campamento juntitossss",
        texto: "Estaba rodeado de tortas la puta madre",
        imagen: "img/2023/campamento.jpeg"
    },
    {
        fecha: "23 DE ENERO 2023",
        titulo: "Picnic y cartasss",
        texto: "",
        imagen: [
            "img/2023/picnic1.jpeg",
            "img/2023/picnic2.jpeg"
        ]
    },
    {
        fecha: "14 DE FEBRERO 2023",
        titulo: "Fotitos con la pequeÃ±a Adol",
        texto: "",
        imagen: [
            "img/2023/adol1.jpeg",
            "img/2023/adol2.jpeg",
            "img/2023/adol3.jpeg"
        ]
    },
    {
        fecha: "18 DE FEBRERO 2023",
        titulo: "rico?",
        texto: "",
        imagen: "img/2023/rico.jpeg"
    },
    {
        fecha: "22 DE FEBRERO DE 2023",
        titulo: "Tu cumpleanituss",
        texto: "",
        imagen: [
            "img/2023/comple2.jpeg",
            "img/2023/comple1.jpeg",
        ]
    },
    {
        fecha: "25 DE FEBRERO DE 2023",
        titulo: "Ultima salidita",
        texto: "",
        imagen: "img/2023/salida.jpeg"
    },
    {
        fecha: "10 DE MARZO DE 2023",
        titulo: "DÃ­a de SSSSPAAA",
        texto: "",
        imagen: "img/2023/spa.jpeg"
    },
    {
        fecha: "21 DE MARZO DE 2023",
        titulo: "Zeballos y una Hamburguesitasss",
        texto: "",
        imagen: "img/2023/zeballos.jpeg"
    },
    {
        fecha: "13 DE MAYO DE 2023",
        titulo: "Tatuajecillo juntooos",
        texto: "",
        imagen: [
            "img/2023/tattoo2.jpeg",
            "img/2023/tattoo1.jpeg"
        ]
    },
    {
        fecha: "1O DE JUNIO DE 2023",
        titulo: "Barcito de Harry y Louis",
        texto: "",
        imagen: "img/2023/hyl.jpeg"
    },
    {
        fecha: "19 DE JUNIO DE 2023",
        titulo: "Fotos re contra randoms",
        texto: "",
        imagen: ["img/2023/random1.jpeg",
                "img/2023/random2.jpeg",
                "img/2023/random3.jpeg"
        ]
    },
    {
        fecha: "20 DE JULIO DE 2023",
        titulo: "Siendo virrrrgos",
        texto: "",
        imagen: [
            "img/2023/virgos1.jpeg",
            "img/2023/virgos2.jpeg",
            "img/2023/virgos3.jpeg"
        ]
    },
    {
        fecha: "22 DE JULIO DE 2023",
        titulo: "Cineeeee",
        texto: "",
        imagen: [
            "img/2023/cine1.jpeg",
            "img/2023/cine2.jpeg"
        ]
    },
    {
        fecha: "29 DE JULIO DE 2023",
        titulo: "Viajecito a Buenos Aires",
        texto: "",
        imagen: [
            "img/2023/bsas1.jpeg",
            "img/2023/bsas2.jpeg",
            "img/2023/bsas3.jpeg"
        ]
    },
    {
        fecha: "1 DE OCTUBRE DE 2023",
        titulo: "Patiecitoo y sol",
        texto: "",
        imagen: [
            "img/2023/patio1.jpeg",
            "img/2023/patio2.jpeg"
        ]
    },
    {
        fecha: "3 DE NOVIEMBRE DE 2023",
        titulo: "Holis soy Kyra, lleguÃ©",
        texto: "",
        imagen: [
            "img/2023/kyra1.jpeg",
            "img/2023/kyra2.jpeg",
            "img/2023/kyra3.jpeg"
        ]
    },
    {
        fecha: "10 DE NOVIEMBRE DE 2023",
        titulo: "Kyrita en el auto",
        texto: "",
        imagen: [
            "img/2023/kyraauto1.jpeg",
            "img/2023/kyraauto2.jpeg",
            "img/2023/kyraauto3.jpeg"
        ]
    },
    {
        fecha: "11 DE NOVIEMBRE DE 2023",
        titulo: "Parque de la costa",
        texto: "(No se si fue tan buen recuerdo)",
        imagen: [
            "img/2023/parque1.jpeg",
            "img/2023/parque2.jpeg",
        ]
    },
    {
        fecha: "15 DE NOVIEMBRE DE 2023",
        titulo: "Esta foto me dio ternura",
        texto: "",
        imagen: "img/2023/adolcumple.jpeg"
    },
    {
        fecha: "25 DE NOVIEMBRE DE 2023",
        titulo: "AJASJASJASAJSJASJASJASJ",
        texto: "",
        imagen: "img/2023/jajaja.jpeg"
    },
    {
        fecha: "26 DE NOVIEMBRE DE 2023",
        titulo: "Vos siendo trola",
        texto: "",
        imagen: [
            "img/2023/trola1.jpeg",
            "img/2023/trola2.jpeg",
            "img/2023/trola3.jpeg"
        ]
    },
    {
        fecha: "25 DE NOVIEMBRE DE 2023",
        titulo: "Naviddddattt",
        texto: "",
        imagen: [
            "img/2023/navidat.jpeg",
            "img/2023/navidat1.jpeg",
            "img/2023/navidat2.jpeg"
        ]
    },
    {
        fecha: "20 DE ENERO DE 2024",
        titulo: "Birrita de con la Rose",
        texto: "",
        imagen: "img/2024/rose.png"
    },
    {
        fecha: "21 DE ENERO DE 2024",
        titulo: "ACA PROBAMOS EL COSITO CON CHOCOLATE",
        texto: "",
        imagen: "img/2024/coso.jpeg"
    },
    {
        fecha: "21 DE ENERO DE 2024",
        titulo: "Libritoxxx",
        texto: "",
        imagen: [
            "img/2024/librito.png",
            "img/2024/librito2.png"
        ]
    },
    {
        fecha: "10 DE FEBRERO DE 2024",
        titulo: "Cumple del Eze",
        texto: "Estabas mamaaadeera",
        imagen: [
            "img/2024/cumple.jpeg",
            "img/2024/cumple2.jpeg",
            "img/2024/cumple3.jpeg"
        ]
    },
    {
        fecha: "14 DE FEBRERO DE 2024",
        titulo: "Anillitoo :Â´(",
        texto: "",
        imagen: "img/2024/anillo.jpeg"
    },
    {
        fecha: "19 DE ABRIL DE 2024",
        titulo: "Casamiento de la Kari y el Seba",
        texto: "",
        imagen: "img/2024/casamiento.jpeg"
    },
    {
        fecha: "30 DE AGOSTO DE 2024",
        titulo: "CumpleaÃ±ito de la Rose",
        texto: "",
        imagen: "img/2024/cumplerose.jpeg"
    },
    {
        fecha: "5 DE OCTUBRE DE 2024",
        titulo: "CumpleaÃ±ito de la Mabel",
        texto: "",
        imagen: [
            "img/2024/cumplemabel.jpeg",
            "img/2024/cumplemabel2.jpeg"
        ]
    },
    {
        fecha: "19 DE OCTUBRE DE 2024",
        titulo: "Barcito con la Rose",
        texto: "(Como nos rompieron el orto)",
        imagen: [
            "img/2024/bar.jpeg",
            "img/2024/bar2.jpeg"
        ]
    },
    {
        fecha: "20 DE OCTUBRE DE 2024",
        titulo: "Zoologicooo",
        texto: "",
        imagen: [
            "img/2024/zoologico.jpeg",
            "img/2024/zoologico2.jpeg"
        ]
    },
    {
        fecha: "17 DE DICIEMRE DE 2024",
        titulo: "Mi graducion y cenita",
        texto: "",
        imagen: "img/2024/graduacion.jpeg"
    },
    {
        fecha: "1 DE ENERO DE 2025",
        titulo: "Vos siendo trola desde el dia uno",
        texto: "y una manga de animales",
        imagen: [
            "img/2025/trola.jpeg",
            "img/2025/trola2.jpeg",
            "img/2025/trola3.jpeg",
            "img/2025/trola4.jpeg"
        ]
    },
    {
        fecha: "7 DE ENERO DE 2025",
        titulo: "Gym juntitos",
        texto: "",
        imagen: "img/2025/gym.jpeg"
    },
    {
        fecha: "9 DE FEBRERO DE 2025",
        titulo: "Vos siendo trola de nuevo",
        texto: "",
        imagen: [
            "img/2025/trolasa.jpeg",
            "img/2025/trolasa2.jpeg",
            "img/2025/trolasa3.jpeg"
        ]
    },
    {
        fecha: "28 DE ABRIL DE 2025",
        titulo: "Mas Gymmm",
        texto: "y mÃ¡s y mÃ¡s y mÃ¡sssss",
        imagen: [
            "img/2025/gym2.jpeg",
            "img/2025/gym3.jpeg"
        ]
    },
    {
        fecha: "22 DE JUNIO DE 2025",
        titulo: "Meriendita con la Adolfi",
        texto: "",
        imagen: "img/2025/adol.jpeg",
            
    },
    {
        fecha: "29 DE JUNIO DE 2025",
        titulo: "Cumple de la Cataaaa",
        texto: "",
        imagen: "img/2025/cata.jpeg",
            
    },
    {
        fecha: "20 DE SEPTIEMBRE DE 2025",
        titulo: "CumpleaÃ±itos de la Rose y la Lidia",
        texto: "",
        imagen: [
            "img/2025/myl.jpeg",
            "img/2025/myl2.jpeg",
            "img/2025/myl3.jpeg",
            "img/2025/myl4.jpeg",
            "img/2025/myl5.jpeg"
        ]
    },
    {
        fecha: "28 DE OCTUBRE DE 2025",
        titulo: "FOTITOS JUNTITUUUUS",
        texto: "",
        imagen: [
            "img/2025/fotitos.jpeg",
            "img/2025/fotitos2.jpeg",
            "img/2025/fotitos3.jpeg",
            "img/2025/fotitos4.jpeg"
        ]
    },
    {
        fecha: "19 DE NOVIEMBRE DE 2025",
        titulo: "Mi recibida jiji",
        texto: "",
        imagen: [
            "img/2025/recibida.jpeg",
            "img/2025/recibida2.jpeg",
            "img/2025/recibida3.jpeg",
            "img/2025/recibida4.jpeg"
        ]
    },
    {
        fecha: "9 DE DICIEMBRE DE 2025",
        titulo: "Spaaaa",
        texto: "QUE BUENA QUE ESTAS PUTA TE AMO",
        imagen: [
            "img/2025/spa.jpeg",
            "img/2025/spa2.jpeg",
            "img/2025/spa3.jpeg",
            "img/2025/spa4.jpeg",
            "img/2025/spa5.jpeg",
            "img/2025/spa6.jpeg"
        ]
    },
    {
        fecha: "24 DE ENERO DE 2026",
        titulo: "Fotitos jiji",
        texto: "",
        imagen: [
            "img/2026/fotitos.jpeg",
            "img/2026/fotitos2.jpeg",
            "img/2026/fotitos3.jpeg",
            "img/2026/fotitos4.jpeg"
        ]
    },
    {
        fecha: "10 DE FEBRERO DE 2026",
        titulo: "Cumple del Eze",
        texto: "Del inala creatina (JODAAAA)",
        imagen: [
            "img/2026/eze.jpeg",
            "img/2026/eze2.jpeg"
        ]
    },
    {
        fecha: "10 DE FEBRERO DE 2026",
        titulo: "Y el CumpleaÃ±itus de la Kari",
        texto: "",
        imagen: [
            "img/2026/kari.jpeg",
            "img/2026/kari2.jpeg",
            "img/2026/kari3.jpeg"
        ]
    },
    ];

    

    const timeline = document.getElementById("timeline");
    const fotosLluvia = [
        "img/especial/01.jpg",
        "img/2022/salida.jpeg",
        "img/2022/casamiento_mabel1.jpeg",
        "img/2022/anio_nuevo1.jpeg",
        "img/2023/picnic1.jpeg",
        "img/2023/rico.jpeg",
        "img/2025/fotitos.jpeg"
    ];

    timelineData.forEach((event, index) => {
    const side = index % 2 === 0 ? "left" : "right";


    let imageHTML = "";

    if (Array.isArray(event.imagen)) {
        imageHTML = `
        <div class="carousel">
            ${event.imagen.map((img, i) => `
            <img src="${img}" class="carousel-img ${i === 0 ? 'active' : ''}">
            `).join("")}
            <button class="carousel-btn prev">â€¹</button>
            <button class="carousel-btn next">â€º</button>
        </div>
        `;
    } else {
        imageHTML = `<img src="${event.imagen}" alt="${event.titulo}">`;
    }

    const eventHTML = `
        <div class="event ${side}">
        <h3>${event.fecha}</h3>
        <div class="event-content">
            <h2>${event.titulo}</h2>
            <p>${event.texto}</p>
            ${imageHTML}
        </div>
        </div>
    `;

    timeline.innerHTML += eventHTML;
    });

    // Abrir/cerrar eventos
    document.querySelectorAll('.event').forEach(event => {
    event.addEventListener('click', () => {
        event.classList.toggle('active');
    });
    });

    // ðŸŽ  Carrusel
    document.querySelectorAll('.carousel').forEach(carousel => {
    const imgs = carousel.querySelectorAll('.carousel-img');
    const prev = carousel.querySelector('.prev');
    const next = carousel.querySelector('.next');
    let index = 0;

    prev.addEventListener('click', e => {
        e.stopPropagation();
        imgs[index].classList.remove('active');
        index = (index - 1 + imgs.length) % imgs.length;
        imgs[index].classList.add('active');
    });

    next.addEventListener('click', e => {
        e.stopPropagation();
        imgs[index].classList.remove('active');
        index = (index + 1) % imgs.length;
        imgs[index].classList.add('active');
    });
    });

// ðŸ“– Libro
const cover = document.getElementById("cover");
const book = document.getElementById("book");
const startStory = document.getElementById("startStory");
const bookWrapper = document.getElementById("book-wrapper");

cover.addEventListener("click", () => {
    book.classList.add("open");
});

startStory.addEventListener("click", () => {
    // Gira libro
    book.classList.add("fast-flip");

    let lluvia = setInterval(crearFotoLluvia, 140);

    setTimeout(() => {
        clearInterval(lluvia);
    }, 3000);

    setTimeout(() => {
        bookWrapper.style.display = "none";
    }, 2800);
});


function crearFotoLluvia() {
    console.log("Creando foto lluvia");

    const img = document.createElement("img");
    img.src = fotosLluvia[Math.floor(Math.random() * fotosLluvia.length)];
    img.className = "falling-img";

    img.style.left = Math.random() * 100 + "vw";
    img.style.animationDuration = 1.8 + Math.random() * 2 + "s";
    img.style.transform = `rotate(${Math.random() * 40 - 20}deg)`;

    document.body.appendChild(img);

    setTimeout(() => {
        img.remove();
    }, 4000);
}

const fondosScroll = [
    "img/fondos/paisaje1.jpg",
    "img/fondos/paisaje2.jpg",
    "img/fondos/paisaje3.jpg",
    "img/fondos/paisaje4.jpg",
    "img/fondos/paisaje5.jpg",
    "img/fondos/paisaje6.jpg",
    "img/fondos/paisaje7.jpg",
    "img/fondos/paisaje8.jpg"
];

const bgWrapper = document.getElementById("background-slider");

const layer1 = document.createElement("div");
const layer2 = document.createElement("div");

layer1.className = "bg-layer active";
layer2.className = "bg-layer";

bgWrapper.appendChild(layer1);
bgWrapper.appendChild(layer2);

let capaActual = layer1;
let capaSiguiente = layer2;
let fondoActual = 0;

capaActual.style.backgroundImage = `url('${fondosScroll[0]}')`;

window.addEventListener("scroll", () => {
    const scroll = window.scrollY;
    const altura = document.body.scrollHeight - window.innerHeight;
    const progreso = scroll / altura;

    const nuevoIndex = Math.floor(progreso * fondosScroll.length);

    if (nuevoIndex !== fondoActual && fondosScroll[nuevoIndex]) {
        fondoActual = nuevoIndex;

        capaSiguiente.style.backgroundImage = `url('${fondosScroll[nuevoIndex]}')`;
        capaSiguiente.classList.add("active");
        capaActual.classList.remove("active");

        const temp = capaActual;
        capaActual = capaSiguiente;
        capaSiguiente = temp;
    }
});

//Cierre del Libro

let finalMostrado = false;
let cerrandoLibro = false;
let usuarioInteractuo = false;

/* Detectar interacciÃ³n REAL del usuario */
["wheel", "touchstart", "keydown"].forEach(evt => {
    window.addEventListener(evt, () => {
        usuarioInteractuo = true;
    }, { once: true });
});

window.addEventListener("scroll", () => {

    // ðŸš« Si todavÃ­a no hubo interacciÃ³n real, no hacemos nada
    if (!usuarioInteractuo) return;

    const scroll = window.scrollY + window.innerHeight;
    const alturaTotal = document.documentElement.scrollHeight;

    // margen un poco mÃ¡s amplio para evitar disparos prematuros
    if (scroll >= alturaTotal - 20 && !finalMostrado) {

        finalMostrado = true;

        // Mostrar mensaje final
        const mensaje = document.getElementById("final-message");
        if (mensaje) mensaje.classList.add("visible");

        // Esperar antes de iniciar cierre
        setTimeout(() => {
            iniciarCierreLibro();
        }, 4000); // â† podÃ©s cambiar el tiempo acÃ¡
    }
});

function iniciarCierreLibro() {

    if (cerrandoLibro) return;
    cerrandoLibro = true;

    // Desvanecer contenido suavemente
    document.querySelector("header")?.classList.add("fade-out");
    document.querySelector(".timeline")?.classList.add("fade-out");
    document.querySelector("footer")?.classList.add("fade-out");

    // Esperar a que termine el fade
    setTimeout(() => {
        document.getElementById("ending-book")?.classList.add("show");

        // ahora sÃ­ bloquear scroll
        document.body.style.overflow = "hidden";
    }, 2000);
}

/* Forzar inicio arriba */
window.addEventListener("load", () => {
    window.scrollTo(0, 0);
});

/* =============================
   ðŸ’– CORAZONES OPTIMIZADOS
   ============================= */

const heartLayer = document.getElementById("heart-layer");

const MAX_HEARTS = 35; // controla rendimiento
const hearts = [];

/* crear pool */
for(let i=0;i<MAX_HEARTS;i++){
    const h = document.createElement("div");
    h.className = "heart";
    heartLayer.appendChild(h);

    hearts.push({
        el:h,
        x:0,
        y:0,
        speed:0,
        drift:0,
        scale:0,
        active:false
    });
}

/* spawn suave */
function spawnHeart(h){
    h.x = Math.random()*window.innerWidth;
    h.y = window.innerHeight + 40;
    h.speed = 0.3 + Math.random()*0.9;
    h.drift = (Math.random()-0.5)*0.6;
    h.scale = 0.6 + Math.random()*1.4;
    h.active = true;

    h.el.style.opacity = 0.9;
    h.el.style.transform = `translate(${h.x}px,${h.y}px) scale(${h.scale}) rotate(45deg)`;
}

/* loop optimizado */
let lastSpawn = 0;

function animateHearts(t){

    // generar cada cierto tiempo (no por frame)
    if(t - lastSpawn > 320){
        const h = hearts.find(h=>!h.active);
        if(h) spawnHeart(h);
        lastSpawn = t;
    }

    hearts.forEach(h=>{
        if(!h.active) return;

        h.y -= h.speed*2.2;
        h.x += h.drift;

        if(h.y < -40){
            h.active=false;
            h.el.style.opacity=0;
            return;
        }

        h.el.style.transform =
            `translate(${h.x}px,${h.y}px) scale(${h.scale}) rotate(45deg)`;
    });

    requestAnimationFrame(animateHearts);
}

requestAnimationFrame(animateHearts);
